{"version":3,"sources":["../../../app/controller/search/index.js"],"names":["SearchController","req","res","id","params","dbHandler","data","statusCode","farray","larray","oarray","includes","search","map","i","fname","get","lname","organizationname","oranizationname","idArray","split","dSearch","sort","item1","item2","useItem1","useItem2","Math","min","indexOf","console","log","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\n\nimport UserHandler from './../../db/handler/user';\nimport Response from '../Response';\nimport Levenshtein from 'fast-levenshtein';\n\nclass SearchController  extends Response {\n\tasync search(req, res) {\n\t\tconst id = req.params.id;\n\t\tconst dbHandler = new UserHandler();\n\t\tlet data, statusCode;\n\t\t\n\n\t\ttry {\n\t\t\tlet farray, larray, oarray;\n\t\t\tif (!id.includes('_')) // Search single name\n\t\t\t{\n\t\t\t\tdata = await dbHandler.search(id);\n\t\t\t\tfarray = data.map(function(i) { // Array of distance from first names\n\t\t\t\t\tif (i.fname != null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Levenshtein.get(i.fname, id);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 100;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlarray = data.map(function(i) { // Array of distance from last names\n\t\t\t\t\tif (i.lname != null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Levenshtein.get(i.lname, id);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 100;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\toarray = data.map(function(i) { // Array of distance from organization names\n\t\t\t\t\tif (i.organizationname != null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Levenshtein.get(i.oranizationname, id);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 100;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t\telse // Search both names\n\t\t\t{\n\t\t\t\tlet idArray = id.split(\"_\");\n\t\t\t\tdata = await dbHandler.dSearch(idArray);\n\t\t\t\tfarray = data.map(function(i) {\n\t\t\t\t\tif (i.fname != null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Levenshtein.get(i.fname, idArray[0]);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 100;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlarray = data.map(function(i) {\n\t\t\t\t\tif (i.lname != 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Levenshtein.get(i.lname, idArray[1]);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 100;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\toarray = data.map(function(i) {\n\t\t\t\t\tif (i.organizationname != null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Levenshtein.get(i.organizationname, id);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 100;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tdata.sort(function(item1, item2) {\n\t\t\t\tlet useItem1, useItem2;\n\t\t\t\t\tuseItem1 = Math.min(farray[data.indexOf(item1)], larray[data.indexOf(item1)], oarray[data.indexOf(item1)]); // Use smallest levenshtein distance\n\n\t\t\t\t\tuseItem2 = Math.min(farray[data.indexOf(item2)], larray[data.indexOf(item2)],\toarray[data.indexOf(item2)]);\n\n\t\t\t\treturn useItem1 - useItem2; // Sort\n\t\t\t});\n\t\t\tstatusCode = this.statusCode['success'];\n\t\t} catch(err) {\n\t\t\tconsole.log(err);\n\t\t\tdata = 'Internal Processing Error';\n\t\t\tstatusCode = this.statusCode['not found'];\n\t\t}\n\n\t\treturn new Response(data, statusCode);\n\t}\n};\n\nmodule.exports = new SearchController();\n"]}